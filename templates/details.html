<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.css" rel="stylesheet" />

    <title>Compare Go</title>
</head>

<body>
    <section class="bg-white dark:bg-gray-900">
        <div class="py-8 px-4 mx-auto max-w-screen-xl text-center lg:py-8 lg:px-12">
            <div class="mb-4 flex justify-center">
                <img src="{{ url_for('static', filename='/logo.png') }}" alt="mockup" width="240px" class="">
            </div>

            <br><br>
            <div
                class="flex flex-col items-center bg-white border border-gray-200 rounded-lg shadow md:flex-row md:w-full  dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-gray-700">
                <img class="object-contain  m-5 rounded-t-lg h-96 md:h-auto md:w-48 md:rounded-none md:rounded-l-lg"
                    src="{{results.image}}" alt="">
                <div class="flex flex-col justify-between p-4 leading-normal w-full">
                    <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white" id="title"
                        data-id="{{results.id}}">{{results.title}}
                    </h5>
                    <!-- specs in list ul -->
                    <ul class="max-w-md space-y-1 text-gray-500 list-inside dark:text-gray-400">
                        {% for spec in results.points %}
                        <li class="flex items-center">
                            <svg class="w-4 h-4 mr-1.5 text-green-500 dark:text-green-400 flex-shrink-0"
                                fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            {{spec}}
                        </li>
                        {% endfor %}
                    </ul>
                    <div class="flex flex-col space-y-4 sm:flex-row sm:justify-center sm:space-y-0 sm:space-x-4">
                        {% for price in results.prices %}
                        <div
                            class="max-w-sm p-6 bg-white  border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                            <img class="object-contain h-12 mx-auto" src="{{price.website}}" alt="">

                            <h5 class="mb-2 text-2xl font-semibold tracking-tight text-gray-900 dark:text-white">
                                {{price.price}}</h5>

                            <a href="{{price.productUrl}}"
                                class="inline-flex items-center text-blue-600 hover:underline">
                                Buy Now
                                <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z">
                                    </path>
                                    <path
                                        d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z">
                                    </path>
                                </svg>
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>
    </section>
    <!-- reviews -->
    <h1 class="mb-4 text-4xl font-bold tracking-tight text-gray-900 dark:text-white text-center">Reviews</h3>
        <div class="flex items-center justify-center">
            <svg aria-hidden="true" class="w-10 h-10 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <title>Rating star</title>
                <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                </path>
            </svg>
            <p class="ml-2 text-lg font-bold text-gray-900 dark:text-white">{{productDetail.overallRating}}</p>
            <span class="w-1 h-1 mx-1.5 bg-gray-500 rounded-full dark:bg-gray-400"></span>
            <a href="#"
                class="text-md font-medium text-gray-900 underline hover:no-underline dark:text-white">{{productDetail.reviewsCount}}
                reviews</a>
        </div>
        <div class="flex flex-col items-center justify-center w-full">

            <div class="max-w-screen-md w-full">
                <div
                    class="w-full mb-4 border border-gray-200 rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600">
                    <div class="px-4 py-2 bg-white rounded-t-lg dark:bg-gray-800">
                        <label for="comment" class="sr-only">Your comment</label>
                        <textarea id="comment" rows="4"
                            class="w-full px-0 text-sm text-gray-900 bg-white border-0 dark:bg-gray-800 focus:ring-0 dark:text-white dark:placeholder-gray-400"
                            placeholder="Write a comment..." required></textarea>
                    </div>
                    <div class="flex items-center justify-between px-3 py-2 border-t dark:border-gray-600">
                        <button id="add-review" onclick="addReview(this)"
                            class="inline-flex items-center py-2.5 px-4 text-xs font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-blue-200 dark:focus:ring-blue-900 hover:bg-blue-800">
                            Post comment
                        </button>

                    </div>
                </div>
            </div>
            {% for review in productDetail.reviews %}
            <figure class="max-w-screen-md w-full">
                <div class="flex items-center mb-4 text-yellow-300">
                    {% for i in range(review.rating) %}
                    <svg aria-hidden="true" class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                        </path>
                    </svg>
                    {% endfor %}
                </div>
                <blockquote>
                    <p class="text-2xl font-semibold text-gray-900 dark:text-white">"{{review.comment}}"</p>
                </blockquote>
                <br><br>
            </figure>
            {% endfor %}
            <input id="product_id" style="display:none" value="{{results.id}}">

        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.js"></script>
        <script>
            function addReview(e) {
                // disable button
                e.disabled = true;
                // e.preventDefault();
                var comment = document.getElementById("comment").value;
                if(comment == ""){
                    alert("Please enter a comment");
                    return;
                }
                var product_id = document.getElementById("product_id").value;
                var rating = 0;
                console.log(product_id);
                // fetch to /api/predict
                fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "comment": comment,
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        rating = data["stars"];
                        console.log(rating);
                        fetch('/api/review', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({

                                id: product_id,
                                review: {
                                    comment: comment,
                                    rating: rating
                                }
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success:', data);
                                location.reload();
                            })
                            .catch((error) => {
                                console.error('Error:', error);
                            });

                    })
                    ;

                // fetch to /api/review

            }
        </script>
</body>

</html>